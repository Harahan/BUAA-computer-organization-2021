# p6课上

非常水，套路题，就条件存，跳转，乘除计算类

但是用AT法的同学注意一下，如果你们的条件访存在M级就得到了写入地址，如下图就是``M``级的``CTRL``的``GRF``写入地址，对于``lhonez``这条指令已经得到写入地址了（就相当于在``M``级和``lw``一样了，不是在``W``级才将写入地址连到``CTRL``里面 ），那么就是说在``M``级前不知到写入地址，那么当该条指令在``E``级时要特判一下阻塞，在``M``级就像正常的``load``类指令用``Tuse``,``Tnew``判断就好了

```verilog
wire [4:0] lhonez_a = (lhonez_ch === 1'bz || lhonez_ch === 1'bx)? 0 : (lhonez_ch === 1'b1)? rt : 32'd31;
assign gwa_res = ((count_r && !movz)| jalr | mf)? rd : 
					     (count_i | load)? rt :
					     (jal)? 5'd31 :
					     (bgezal | bltzal)?((b_j)?5'd31: 5'b0 ):
						 (movz)? movz_a :
						 (jap)? 5'd29 :
						 (lhonez)? lhonez_a :
					     5'b0; 
```

​       但是注意上面说的可能有``bug``,建议该指令在``M``级的时候也像``E``那样特判阻塞，严格来说不用，但是我``p5``应该就是因为这个挂了第``3``题，``p6``前两道做的快，于是有时间，就在阻塞这里反复试探发现特判时硬阻一个周期过不了，条件阻一个也过不了，硬阻两个只有一个点``TLE``了，于是条件阻两个周期就过了

​       但是按照最上面的分析来说其实只用条件阻一个周期，就是该指令在``E``级时条件阻。在``M``级时候不用特判然后条件阻，而是用像``lw``那样的``Tuse``,``Tnew``判断就好，不用改阻塞。至于为什么过不了，懒得想了，反正``p6``过了，没有条件访存了。

​		总之如果是按照上面做法做的建议特判条件阻两个周期（你可能会说那和``W``级再得到结果有什么区别吗？我觉得没什么区别了。。。），下面代码就只条件阻了一个周期，再复制一遍，把``E``改成``M``就好了：

```verilog
assign stall_lhonez = (E_lhonez && (((D_rs == E_rt || D_rs == 5'd31) && (D_rs != 5'd0) && (Tuse_rs < Tnew_E)) || ((D_rt == E_rt || D_rt == 5'd31) && (D_rs != 5'd0) && (Tuse_rt < Tnew_E))));
```

我仓库里面自己课下练习的往年题的代码都只条件阻了一个周期，可能过不了，改阻两个应该可以了（其实我``p5``，``p6``的条件访存加完后做了功能测试，阻塞也测了，但就是没通过，但当``p6``多特判后就通过了。。。）





